<!DOCTYPE html>
<html>
  <div>
    <h1>Go websockets</h1>
    <div>Send a message</div>
    <pre id="status">Status: Offline</pre>
    <input id="input" type="text" size="40" />
    <button onclick="send()">Send</button>
    <div>Sent messages:</div>
    <pre id="output"></pre>
  </div>

  <script>
    const input = document.getElementById("input")
    const status = document.getElementById("status")
    const output = document.getElementById("output")

    let socketIsOpen = false
    const socket = new WebSocket("ws://192.168.1.12:4000/websocket-test")

    socket.onopen = () => {
      socketIsOpen = true
      status.innerHTML = "Status: Connected"
    }
    
    socket.onclose = () => {
      socketIsOpen = false
      status.innerHTML = "Status: Offline"
    }

    socket.onmessage = (e) => {
      const response = JSON.parse(e.data)
      output.innerHTML = ""
      for (let i = response.length - 1; i >= 0; i--) {
        output.innerHTML += `User ${response[i].clientId}: "${response[i].text}"\n`
      }
    }

    function send() {
      if (socket && socketIsOpen) {
        const message = input.value.trim()
        input.value = ""

        if (message.length > 0 && message.length <= 1024) {
          socket.send(message)
        }
      }
    }
  </script>

  <style>
    html, div {
      text-align: center;
      font-size: 20px;
      font-family: sans-serif;
    }
    pre {
      /* word-wrap: break-word; */
      /* word-break: break-all; */
      overflow-wrap: break-word;
      white-space: break-spaces;
      font-size: 20px;
    }
    #input, p, button {
      font-size: 20px;
      font-family: sans-serif;
    }
    div {
      padding: 1rem;
    }
  </style>
</html>
